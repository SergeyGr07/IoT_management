# Сервис мониторинга уровня воды

![CI/CD Status](https://github.com/politeh/IoT_management/actions/workflows/main.yml/badge.svg)

Микросервис для получения и обработки данных об уровне воды от IoT устройств.

## Описание

Сервис принимает HTTP POST запросы с данными об уровне воды и обрабатывает их. При превышении критического уровня (350) выводится предупреждение.

## Технологии

- Python 3.11
- Flask
- Docker & Docker Compose
- Nginx (для балансировки нагрузки и ограничения частоты запросов)
- GitHub Actions (CI/CD)

## Структура проекта

```
.
├── app.py              # Основной файл приложения
├── test_app.py         # Модульные тесты
├── requirements.txt    # Зависимости Python
├── Dockerfile         # Конфигурация Docker
├── docker-compose.yml # Конфигурация Docker Compose
├── nginx.conf         # Конфигурация Nginx
└── .github/workflows  # Конфигурация CI/CD
```

## API

### Endpoint: POST /water-level

Принимает JSON-данные следующего формата:
```json
{
  "water_level": 450
}
```

#### Параметры
- `water_level`: число (целое или дробное), уровень воды

#### Ответ
```json
{
  "status": "ok"
}
```

#### Коды ответов
- 200: Успешная обработка
- 400: Ошибка в запросе (неверный формат данных)
- 500: Внутренняя ошибка сервера

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd IoT_management
```

2. Запустите через Docker Compose:
```bash
docker compose up -d
```

Сервис будет доступен по адресу: `http://localhost:5055`

## Особенности

- Ограничение частоты запросов: не чаще 1 запроса в 5 секунд
- Автоматическое развертывание при push в ветку main
- Автоматическое тестирование перед деплоем
- Масштабируемость через Docker Compose
- Поддержка дробных значений уровня воды

## CI/CD

Настроен автоматический процесс тестирования и развертывания через GitHub Actions:
1. При каждом push в ветку main запускаются тесты
2. При успешном прохождении тестов происходит автоматический деплой
3. Развертывание происходит на сервере через Docker Compose

## Требования к системе

- Docker
- Docker Compose
- Доступ к порту 5055
